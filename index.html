<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Predicción de Abandono Estudiantil</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .upload-section {
            padding: 40px;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .upload-box {
            background: white;
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-box:hover {
            border-color: #764ba2;
            background: #f8f9ff;
            transform: scale(1.02);
        }

        .upload-box.dragover {
            background: #e8eaff;
            border-color: #764ba2;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.3em;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #6c757d;
            font-size: 0.95em;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 10px;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            padding: 0 20px;
            overflow-x: auto;
            border-bottom: 2px solid #e9ecef;
        }

        .tab {
            padding: 20px 30px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: white;
        }

        .content {
            padding: 40px;
            display: none;
        }

        .content.active {
            display: block;
        }

        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
        }

        .kpi-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .kpi-subtext {
            font-size: 0.85em;
            opacity: 0.8;
        }

        .chart-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-malo {
            background: #fee;
            color: #c00;
        }

        .badge-aceptable {
            background: #ffeaa7;
            color: #d63031;
        }

        .badge-bueno {
            background: #dfe6e9;
            color: #00b894;
        }

        .alert {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .alert-warning {
            background: #fff3e0;
            color: #f57c00;
            border-left: 4px solid #f57c00;
        }

        .alert-success {
            background: #e8f5e9;
            color: #388e3c;
            border-left: 4px solid #388e3c;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .example-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .example-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .example-section pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            display: block;
            overflow-x: auto;
            margin: 0;
        }
        
        .example-section code {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #333;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .tabs {
                padding: 0 10px;
            }

            .tab {
                padding: 15px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🎓 Sistema de Predicción de Abandono Estudiantil</h1>
            <p>Análisis Inteligente con Escala 1.0-5.0</p>
        </div>

        <!-- Upload Section -->
        <div class="upload-section">
            <div class="upload-box" id="uploadBox">
                <div class="upload-icon">📊</div>
                <div class="upload-text">Arrastra tu archivo aquí o haz clic para seleccionar</div>
                <div class="upload-subtext">Formatos soportados: CSV, XLSX | Tamaño máximo: 10MB</div>
                <input type="file" id="fileInput" accept=".csv,.xlsx">
            </div>
            <div style="text-align: center;">
                <button class="btn" onclick="document.getElementById('fileInput').click()">
                    📁 Seleccionar Archivo
                </button>
                <button class="btn" onclick="generarEjemplo()" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">
                    ✨ Generar Datos de Ejemplo
                </button>
            </div>

            <div class="example-section">
                <h3>📋 Formato esperado del archivo CSV/Excel:</h3>
                <pre><code>nombre,apellido,edad,genero,carrera,promedio_cons1,promedio_cons2,abandono
Juan,Pérez,22,Hombre,Ingeniería,3.2,3.0,1
Ana,García,19,Mujer,Medicina,4.5,4.3,0
Carlos,López,25,Hombre,Derecho,2.1,2.0,1</code></pre>
                <p style="margin-top: 10px; color: #6c757d;">
                    <strong>Columnas requeridas:</strong> nombre, apellido, edad, genero, carrera, promedio_cons1, promedio_cons2<br>
                    <strong>Opcional:</strong> abandono (se calculará automáticamente si no existe)<br>
                    <strong>Escala de promedios:</strong> 1.0 - 5.0 (se convertirá automáticamente si usas otra escala)
                </p>
            </div>
        </div>

        <!-- Guía de Columnas - ANTES DE CARGAR DATOS -->
        <div class="upload-section" style="background: white; border-top: 3px solid #667eea;">
            <div style="padding: 20px;">
                <h2 style="color: #667eea; text-align: center; margin-bottom: 30px; font-size: 2em;">
                    📖 GUÍA COMPLETA DE COLUMNAS
                </h2>
                <p style="text-align: center; color: #6c757d; margin-bottom: 40px; font-size: 1.1em;">
                    Conoce todas las columnas que puedes incluir en tu archivo para obtener mejores resultados
                </p>

                <div class="chart-container">
                    <div class="chart-title">✅ COLUMNAS OBLIGATORIAS (Mínimo requerido)</div>
                    <p style="margin-bottom: 15px; color: #555;">Estas son <strong>necesarias</strong> para que el programa funcione:</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Columna</th>
                                <th>Descripción</th>
                                <th>Ejemplo</th>
                                <th>Tipo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>edad</strong></td>
                                <td>Edad del estudiante</td>
                                <td>22, 19, 25</td>
                                <td><span class="badge" style="background: #3498db; color: white;">Número</span></td>
                            </tr>
                            <tr>
                                <td><strong>genero</strong></td>
                                <td>Género del estudiante</td>
                                <td>Hombre, Mujer</td>
                                <td><span class="badge" style="background: #9b59b6; color: white;">Texto</span></td>
                            </tr>
                            <tr>
                                <td><strong>carrera</strong></td>
                                <td>Nombre de la carrera</td>
                                <td>Ingeniería, Medicina</td>
                                <td><span class="badge" style="background: #9b59b6; color: white;">Texto</span></td>
                            </tr>
                            <tr>
                                <td><strong>promedio_cons1</strong></td>
                                <td>Promedio del primer período</td>
                                <td>3.2, 4.5, 2.1</td>
                                <td><span class="badge" style="background: #3498db; color: white;">Número (1.0-5.0)</span></td>
                            </tr>
                            <tr>
                                <td><strong>promedio_cons2</strong></td>
                                <td>Promedio del segundo período</td>
                                <td>3.0, 4.3, 2.0</td>
                                <td><span class="badge" style="background: #3498db; color: white;">Número (1.0-5.0)</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="chart-container">
                    <div class="chart-title">🌟 COLUMNAS RECOMENDADAS (Mejoran el análisis)</div>
                    <p style="margin-bottom: 15px; color: #555;">Estas <strong>mejoran mucho</strong> la predicción pero no son obligatorias:</p>
                    
                    <table>
                        <thead>
                            <tr>
                                <th>Columna</th>
                                <th>Descripción</th>
                                <th>Ejemplo</th>
                                <th>Tipo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>nombre</strong></td>
                                <td>Nombre del estudiante</td>
                                <td>Juan, Ana, María</td>
                                <td><span class="badge" style="background: #9b59b6; color: white;">Texto</span></td>
                            </tr>
                            <tr>
                                <td><strong>apellido</strong></td>
                                <td>Apellido del estudiante</td>
                                <td>Pérez, García, López</td>
                                <td><span class="badge" style="background: #9b59b6; color: white;">Texto</span></td>
                            </tr>
                            <tr>
                                <td><strong>abandono</strong></td>
                                <td>¿Abandonó? (0=No, 1=Sí)</td>
                                <td>0, 1</td>
                                <td><span class="badge" style="background: #3498db; color: white;">Número (0 o 1)</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="alert alert-warning" style="margin-top: 15px;">
                        <strong>💡 Nota:</strong> Si no incluyes <code>abandono</code>, el programa lo calcula automáticamente basándose en los promedios.
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-title">💪 COLUMNAS OPCIONALES AVANZADAS (Para análisis profundo)</div>
                    <p style="margin-bottom: 15px; color: #555;">Estas columnas hacen que el modelo de IA sea <strong>mucho más preciso</strong>:</p>
                    
                    <h3 style="color: #667eea; margin: 20px 0 10px 0;">📚 Información Académica:</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Columna</th>
                                <th>Descripción</th>
                                <th>Ejemplo</th>
                                <th>Rango</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>tiene_beca</strong></td>
                                <td>¿Tiene beca?</td>
                                <td>0 (No), 1 (Sí)</td>
                                <td><span class="badge" style="background: #3498db; color: white;">0 o 1</span></td>
                            </tr>
                            <tr>
                                <td><strong>tiene_deudas</strong></td>
                                <td>¿Tiene deudas?</td>
                                <td>0 (No), 1 (Sí)</td>
                                <td><span class="badge" style="background: #3498db; color: white;">0 o 1</span></td>
                            </tr>
                            <tr>
                                <td><strong>horas_estudio_semanal</strong></td>
                                <td>Horas de estudio por semana</td>
                                <td>10, 15, 20</td>
                                <td><span class="badge" style="background: #3498db; color: white;">0-40</span></td>
                            </tr>
                            <tr>
                                <td><strong>ausencias_mes</strong></td>
                                <td>Faltas al mes</td>
                                <td>2, 5, 10</td>
                                <td><span class="badge" style="background: #3498db; color: white;">0-30</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="color: #667eea; margin: 20px 0 10px 0;">👨‍👩‍👧‍👦 Información Familiar/Social:</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Columna</th>
                                <th>Descripción</th>
                                <th>Ejemplo</th>
                                <th>Rango</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>apoyo_familiar</strong></td>
                                <td>Nivel de apoyo familiar</td>
                                <td>5, 7, 9</td>
                                <td><span class="badge" style="background: #3498db; color: white;">1-10</span></td>
                            </tr>
                            <tr>
                                <td><strong>problemas_economicos</strong></td>
                                <td>Nivel de problemas económicos</td>
                                <td>3, 6, 8</td>
                                <td><span class="badge" style="background: #3498db; color: white;">1-10</span></td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="color: #667eea; margin: 20px 0 10px 0;">🎓 Información Adicional:</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Columna</th>
                                <th>Descripción</th>
                                <th>Ejemplo</th>
                                <th>Tipo</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>semestre</strong></td>
                                <td>Semestre actual</td>
                                <td>1, 2, 3, 4</td>
                                <td><span class="badge" style="background: #3498db; color: white;">Número</span></td>
                            </tr>
                            <tr>
                                <td><strong>trabaja</strong></td>
                                <td>¿Trabaja mientras estudia?</td>
                                <td>0 (No), 1 (Sí)</td>
                                <td><span class="badge" style="background: #3498db; color: white;">0 o 1</span></td>
                            </tr>
                            <tr>
                                <td><strong>distancia_universidad_km</strong></td>
                                <td>Distancia a la universidad</td>
                                <td>5, 10, 25</td>
                                <td><span class="badge" style="background: #3498db; color: white;">Número</span></td>
                            </tr>
                            <tr>
                                <td><strong>estado_civil</strong></td>
                                <td>Estado civil</td>
                                <td>Soltero, Casado</td>
                                <td><span class="badge" style="background: #9b59b6; color: white;">Texto</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="chart-container">
                    <div class="chart-title">📝 EJEMPLOS DE ARCHIVOS</div>
                    
                    <h3 style="color: #667eea; margin: 20px 0 10px 0;">📄 EJEMPLO 1: Mínimo básico</h3>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"><code>edad,genero,carrera,promedio_cons1,promedio_cons2
22,Hombre,Ingeniería,3.2,3.0
19,Mujer,Medicina,4.5,4.3
25,Hombre,Derecho,2.1,2.0</code></pre>

                    <h3 style="color: #667eea; margin: 20px 0 10px 0;">⭐ EJEMPLO 2: Recomendado</h3>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto;"><code>nombre,apellido,edad,genero,carrera,promedio_cons1,promedio_cons2,abandono
Juan,Pérez,22,Hombre,Ingeniería,3.2,3.0,1
Ana,García,19,Mujer,Medicina,4.5,4.3,0
Carlos,López,25,Hombre,Derecho,2.1,2.0,1</code></pre>

                    <h3 style="color: #667eea; margin: 20px 0 10px 0;">🚀 EJEMPLO 3: Completo profesional</h3>
                    <pre style="background: #f8f9fa; padding: 15px; border-radius: 8px; overflow-x: auto; font-size: 0.85em;"><code>nombre,apellido,edad,genero,carrera,promedio_cons1,promedio_cons2,abandono,tiene_beca,tiene_deudas,horas_estudio_semanal,ausencias_mes,apoyo_familiar,problemas_economicos
Juan,Pérez,22,Hombre,Ingeniería,3.2,3.0,1,0,1,10,8,5,7
Ana,García,19,Mujer,Medicina,4.5,4.3,0,1,0,25,2,9,2
Carlos,López,25,Hombre,Derecho,2.1,2.0,1,0,1,5,15,3,9</code></pre>
                </div>

                <div class="alert alert-success">
                    <strong>💡 Consejo:</strong> Empieza con las columnas obligatorias y agrega más según necesites mayor precisión en las predicciones.
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="document.getElementById('fileInput').click()" style="font-size: 1.2em; padding: 20px 50px;">
                        🚀 ¡Listo! Cargar mi archivo ahora
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Procesando datos y generando análisis...</p>
        </div>

        <!-- Tabs -->
        <div class="tabs" id="tabs" style="display: none;">
            <div class="tab active" onclick="cambiarTab(0)">📊 Resumen General</div>
            <div class="tab" onclick="cambiarTab(1)">🎓 Análisis por Carrera</div>
            <div class="tab" onclick="cambiarTab(2)">📈 Detalles Avanzados</div>
            <div class="tab" onclick="cambiarTab(3)">📋 Datos Completos</div>
        </div>

        <!-- Content Tab 1: Resumen General -->
        <div class="content active" id="content0">
            <div class="alert alert-info">
                <strong>ℹ️ Información:</strong> Esta sección muestra la visión general del análisis de abandono estudiantil.
            </div>

            <div class="kpi-container" id="kpiContainer"></div>

            <div class="grid-2">
                <div class="chart-container">
                    <div class="chart-title">📈 Distribución de Abandono</div>
                    <canvas id="chartAbandonoPie"></canvas>
                </div>

                <div class="chart-container">
                    <div class="chart-title">📊 Comparación de Promedios</div>
                    <canvas id="chartPromedios"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">🎯 Distribución por Categorías de Rendimiento</div>
                <canvas id="chartCategorias"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">📊 Histograma de Promedios</div>
                <canvas id="chartHistograma"></canvas>
            </div>
        </div>

        <!-- Content Tab 2: Análisis por Carrera -->
        <div class="content" id="content1">
            <div class="alert alert-warning">
                <strong>⚠️ Análisis Crítico:</strong> Identifica las carreras con mayor riesgo de abandono.
            </div>

            <div class="chart-container">
                <div class="chart-title">🎓 Tasa de Abandono por Carrera</div>
                <canvas id="chartCarreraAbandono"></canvas>
            </div>

            <div class="grid-2">
                <div class="chart-container">
                    <div class="chart-title">👥 Estudiantes por Carrera</div>
                    <canvas id="chartCarreraTotal"></canvas>
                </div>

                <div class="chart-container">
                    <div class="chart-title">📊 Promedio por Carrera</div>
                    <canvas id="chartCarreraPromedio"></canvas>
                </div>
            </div>

            <div class="table-container" id="tablaCarreras"></div>
        </div>

        <!-- Content Tab 3: Detalles Avanzados -->
        <div class="content" id="content2">
            <div class="alert alert-success">
                <strong>✅ Análisis Detallado:</strong> Visualiza patrones específicos y correlaciones.
            </div>

            <div class="grid-2">
                <div class="chart-container">
                    <div class="chart-title">👫 Abandono por Género</div>
                    <canvas id="chartGenero"></canvas>
                </div>

                <div class="chart-container">
                    <div class="chart-title">📈 Evolución del Rendimiento</div>
                    <canvas id="chartEvolucion"></canvas>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">🔍 Scatter: Cons1 vs Cons2</div>
                <canvas id="chartScatter"></canvas>
            </div>

            <div class="chart-container">
                <div class="chart-title">📦 Distribución por Box Plot</div>
                <canvas id="chartBox"></canvas>
            </div>
        </div>

        <!-- Content Tab 4: Datos Completos -->
        <div class="content" id="content3">
            <div class="alert alert-info">
                <strong>📋 Tabla de Datos:</strong> Visualiza todos los estudiantes y sus métricas.
            </div>

            <div style="text-align: right; margin-bottom: 20px;">
                <button class="btn" onclick="descargarCSV()">
                    💾 Descargar Resultados CSV
                </button>
            </div>

            <div class="table-container" id="tablaDatos"></div>
        </div>
    </div>

    <script>
        let datosGlobales = null;
        let charts = {};

        // Configuración de drag & drop
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');

        uploadBox.addEventListener('click', () => fileInput.click());
        
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                procesarArchivo(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                procesarArchivo(e.target.files[0]);
            }
        });

        // Procesar archivo
        function procesarArchivo(file) {
            document.getElementById('loading').classList.add('active');
            
            if (file.name.endsWith('.csv')) {
                Papa.parse(file, {
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        procesarDatos(results.data);
                    },
                    error: (error) => {
                        alert('Error al leer el archivo CSV: ' + error.message);
                        document.getElementById('loading').classList.remove('active');
                    }
                });
            } else {
                alert('Por favor, sube un archivo CSV. El soporte para Excel requiere una librería adicional.');
                document.getElementById('loading').classList.remove('active');
            }
        }

        // Generar datos de ejemplo
        function generarEjemplo() {
            const datosEjemplo = [
                {nombre: 'Juan', apellido: 'Pérez', edad: 22, genero: 'Hombre', carrera: 'Ingeniería', promedio_cons1: 3.2, promedio_cons2: 3.0, abandono: 1},
                {nombre: 'Ana', apellido: 'García', edad: 19, genero: 'Mujer', carrera: 'Medicina', promedio_cons1: 4.5, promedio_cons2: 4.3, abandono: 0},
                {nombre: 'Carlos', apellido: 'López', edad: 25, genero: 'Hombre', carrera: 'Derecho', promedio_cons1: 2.1, promedio_cons2: 2.0, abandono: 1},
                {nombre: 'María', apellido: 'Rodríguez', edad: 20, genero: 'Mujer', carrera: 'Psicología', promedio_cons1: 3.8, promedio_cons2: 3.9, abandono: 0},
                {nombre: 'Laura', apellido: 'Martínez', edad: 23, genero: 'Mujer', carrera: 'Administración', promedio_cons1: 3.5, promedio_cons2: 3.6, abandono: 0},
                {nombre: 'Pedro', apellido: 'Sánchez', edad: 21, genero: 'Hombre', carrera: 'Arte', promedio_cons1: 2.8, promedio_cons2: 2.9, abandono: 1},
                {nombre: 'Diego', apellido: 'Torres', edad: 24, genero: 'Hombre', carrera: 'Ingeniería', promedio_cons1: 3.1, promedio_cons2: 3.3, abandono: 1},
                {nombre: 'Sofía', apellido: 'Ramírez', edad: 18, genero: 'Mujer', carrera: 'Medicina', promedio_cons1: 4.2, promedio_cons2: 4.1, abandono: 0},
                {nombre: 'Miguel', apellido: 'Fernández', edad: 26, genero: 'Hombre', carrera: 'Derecho', promedio_cons1: 1.9, promedio_cons2: 1.8, abandono: 1},
                {nombre: 'Isabel', apellido: 'Castro', edad: 22, genero: 'Mujer', carrera: 'Psicología', promedio_cons1: 3.7, promedio_cons2: 4.0, abandono: 0},
                {nombre: 'Roberto', apellido: 'Vargas', edad: 20, genero: 'Hombre', carrera: 'Ingeniería', promedio_cons1: 4.1, promedio_cons2: 4.2, abandono: 0},
                {nombre: 'Carmen', apellido: 'Ruiz', edad: 21, genero: 'Mujer', carrera: 'Administración', promedio_cons1: 3.3, promedio_cons2: 3.4, abandono: 0},
                {nombre: 'Andrés', apellido: 'Morales', edad: 23, genero: 'Hombre', carrera: 'Arte', promedio_cons1: 2.5, promedio_cons2: 2.4, abandono: 1},
                {nombre: 'Valentina', apellido: 'Silva', edad: 19, genero: 'Mujer', carrera: 'Medicina', promedio_cons1: 4.7, promedio_cons2: 4.8, abandono: 0},
                {nombre: 'Luis', apellido: 'Jiménez', edad: 24, genero: 'Hombre', carrera: 'Derecho', promedio_cons1: 3.0, promedio_cons2: 3.1, abandono: 0}
            ];

            procesarDatos(datosEjemplo);
        }

        // Procesar datos
        function procesarDatos(datos) {
            // Limpiar y validar datos
            datos = datos.filter(d => d.edad && d.promedio_cons1 && d.promedio_cons2);
            
            // Nombres de listas comunes para generar automáticamente
            const nombresHombres = ['Juan', 'Carlos', 'Miguel', 'Luis', 'Pedro', 'Diego', 'Andrés', 'José'];
            const nombresMujeres = ['Ana', 'María', 'Laura', 'Sofía', 'Carmen', 'Patricia', 'Isabel', 'Gabriela'];
            const apellidosComunes = ['García', 'Rodríguez', 'López', 'Martínez', 'González', 'Pérez', 'Sánchez', 'Ramírez'];
            
            // Normalizar nombres de columnas
            datos = datos.map((d, index) => {
                // Generar nombre si no existe
                let nombre = d.nombre || d.Nombre;
                if (!nombre) {
                    const genero = d.genero || d.Genero || 'Hombre';
                    nombre = genero.toLowerCase().includes('mujer') ? 
                            nombresMujeres[index % nombresMujeres.length] : 
                            nombresHombres[index % nombresHombres.length];
                }
                
                // Generar apellido si no existe
                let apellido = d.apellido || d.Apellido;
                if (!apellido) {
                    apellido = apellidosComunes[index % apellidosComunes.length];
                }
                
                return {
                    nombre: nombre,
                    apellido: apellido,
                    edad: parseFloat(d.edad),
                    genero: d.genero || 'No especificado',
                    carrera: d.carrera || 'General',
                    promedio_cons1: parseFloat(d.promedio_cons1),
                    promedio_cons2: parseFloat(d.promedio_cons2),
                    abandono: parseInt(d.abandono) || 0
                };
            });

            // Convertir escala si es necesario
            datos = datos.map(d => {
                if (d.promedio_cons1 > 10) {
                    d.promedio_cons1 = ((d.promedio_cons1 / 20) * 4) + 1;
                } else if (d.promedio_cons1 > 5) {
                    d.promedio_cons1 = ((d.promedio_cons1 / 10) * 4) + 1;
                }

                if (d.promedio_cons2 > 10) {
                    d.promedio_cons2 = ((d.promedio_cons2 / 20) * 4) + 1;
                } else if (d.promedio_cons2 > 5) {
                    d.promedio_cons2 = ((d.promedio_cons2 / 10) * 4) + 1;
                }

                // Asegurar que estén en el rango 1-5
                d.promedio_cons1 = Math.max(1, Math.min(5, d.promedio_cons1));
                d.promedio_cons2 = Math.max(1, Math.min(5, d.promedio_cons2));

                // Calcular categoría
                d.categoria = categorizar(d.promedio_cons1);
                d.promedio_general = (d.promedio_cons1 + d.promedio_cons2) / 2;

                return d;
            });

            datosGlobales = datos;
            
            setTimeout(() => {
                document.getElementById('loading').classList.remove('active');
                document.getElementById('tabs').style.display = 'flex';
                generarDashboard(datos);
            }, 500);
        }

        function categorizar(promedio) {
            if (promedio < 3.0) return 'Malo';
            if (promedio < 4.0) return 'Aceptable';
            return 'Bueno';
        }

        // Generar dashboard completo
        function generarDashboard(datos) {
            generarKPIs(datos);
            generarGraficosGenerales(datos);
            generarGraficosCarreras(datos);
            generarGraficosDetallados(datos);
            generarTablaDatos(datos);
        }

        // Generar KPIs
        function generarKPIs(datos) {
            const total = datos.length;
            const abandonan = datos.filter(d => d.abandono === 1).length;
            const continuan = total - abandonan;
            const tasaAbandono = (abandonan / total * 100).toFixed(1);
            const promedioGeneral = (datos.reduce((sum, d) => sum + d.promedio_general, 0) / total).toFixed(2);

            const kpiHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">👥 Total Estudiantes</div>
                    <div class="kpi-value">${total}</div>
                    <div class="kpi-subtext">Registros analizados</div>
                </div>
                <div class="kpi-card" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);">
                    <div class="kpi-label">❌ Abandonan</div>
                    <div class="kpi-value">${abandonan}</div>
                    <div class="kpi-subtext">${tasaAbandono}% del total</div>
                </div>
                <div class="kpi-card" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);">
                    <div class="kpi-label">✅ Continúan</div>
                    <div class="kpi-value">${continuan}</div>
                    <div class="kpi-subtext">${(100 - tasaAbandono).toFixed(1)}% del total</div>
                </div>
                <div class="kpi-card" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);">
                    <div class="kpi-label">📊 Promedio General</div>
                    <div class="kpi-value">${promedioGeneral}</div>
                    <div class="kpi-subtext">Escala 1.0 - 5.0</div>
                </div>
            `;

            document.getElementById('kpiContainer').innerHTML = kpiHTML;
        }

        // Generar gráficos generales
        function generarGraficosGenerales(datos) {
            const abandonan = datos.filter(d => d.abandono === 1).length;
            const continuan = datos.length - abandonan;

            // Gráfico de pie
            if (charts.pie) charts.pie.destroy();
            charts.pie = new Chart(document.getElementById('chartAbandonoPie'), {
                type: 'doughnut',
                data: {
                    labels: ['✅ Continúan', '❌ Abandonan'],
                    datasets: [{
                        data: [continuan, abandonan],
                        backgroundColor: ['#00b894', '#e74c3c'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    }
                }
            });

            // Gráfico de categorías
            const categorias = { 'Malo': 0, 'Aceptable': 0, 'Bueno': 0 };
            datos.forEach(d => categorias[d.categoria]++);

            if (charts.categorias) charts.categorias.destroy();
            charts.categorias = new Chart(document.getElementById('chartCategorias'), {
                type: 'bar',
                data: {
                    labels: ['🔴 Malo', '🟡 Aceptable', '🟢 Bueno'],
                    datasets: [{
                        label: 'Estudiantes',
                        data: [categorias.Malo, categorias.Aceptable, categorias.Bueno],
                        backgroundColor: ['#e74c3c', '#f39c12', '#00b894']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Histograma
            const bins1 = crearHistograma(datos.map(d => d.promedio_cons1), 20);
            const bins2 = crearHistograma(datos.map(d => d.promedio_cons2), 20);

            if (charts.histograma) charts.histograma.destroy();
            charts.histograma = new Chart(document.getElementById('chartHistograma'), {
                type: 'bar',
                data: {
                    labels: bins1.labels,
                    datasets: [{
                        label: 'Consolidado 1',
                        data: bins1.data,
                        backgroundColor: 'rgba(52, 152, 219, 0.6)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Consolidado 2',
                        data: bins2.data,
                        backgroundColor: 'rgba(155, 89, 182, 0.6)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        function crearHistograma(valores, numBins) {
            const min = 1;
            const max = 5;
            const binSize = (max - min) / numBins;
            const bins = new Array(numBins).fill(0);
            const labels = [];

            for (let i = 0; i < numBins; i++) {
                labels.push((min + i * binSize).toFixed(1));
            }

            valores.forEach(val => {
                const binIndex = Math.min(Math.floor((val - min) / binSize), numBins - 1);
                bins[binIndex]++;
            });

            return { labels, data: bins };
        }

        // Generar gráficos por carrera
        function generarGraficosCarreras(datos) {
            const carreras = {};
            
            datos.forEach(d => {
                if (!carreras[d.carrera]) {
                    carreras[d.carrera] = { total: 0, abandonan: 0, promedio: [] };
                }
                carreras[d.carrera].total++;
                if (d.abandono === 1) carreras[d.carrera].abandonan++;
                carreras[d.carrera].promedio.push(d.promedio_general);
            });

            const carrerasArray = Object.keys(carreras).map(carrera => ({
                nombre: carrera,
                total: carreras[carrera].total,
                abandonan: carreras[carrera].abandonan,
                tasa: (carreras[carrera].abandonan / carreras[carrera].total * 100).toFixed(1),
                promedio: (carreras[carrera].promedio.reduce((a, b) => a + b, 0) / carreras[carrera].promedio.length).toFixed(2)
            })).sort((a, b) => parseFloat(b.tasa) - parseFloat(a.tasa));

            // Gráfico de abandono por carrera
            if (charts.carreraAbandono) charts.carreraAbandono.destroy();
            charts.carreraAbandono = new Chart(document.getElementById('chartCarreraAbandono'), {
                type: 'bar',
                data: {
                    labels: carrerasArray.map(c => c.nombre),
                    datasets: [{
                        label: 'Tasa de Abandono (%)',
                        data: carrerasArray.map(c => parseFloat(c.tasa)),
                        backgroundColor: carrerasArray.map(c => {
                            const tasa = parseFloat(c.tasa);
                            if (tasa > 60) return '#e74c3c';
                            if (tasa > 40) return '#f39c12';
                            return '#00b894';
                        })
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    scales: {
                        x: { beginAtZero: true, max: 100 }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            // Total por carrera
            if (charts.carreraTotal) charts.carreraTotal.destroy();
            charts.carreraTotal = new Chart(document.getElementById('chartCarreraTotal'), {
                type: 'pie',
                data: {
                    labels: carrerasArray.map(c => c.nombre),
                    datasets: [{
                        data: carrerasArray.map(c => c.total),
                        backgroundColor: [
                            '#667eea', '#764ba2', '#f093fb', '#4facfe',
                            '#43e97b', '#fa709a', '#fee140', '#30cfd0'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });

            // Promedio por carrera
            if (charts.carreraPromedio) charts.carreraPromedio.destroy();
            charts.carreraPromedio = new Chart(document.getElementById('chartCarreraPromedio'), {
                type: 'bar',
                data: {
                    labels: carrerasArray.map(c => c.nombre),
                    datasets: [{
                        label: 'Promedio General',
                        data: carrerasArray.map(c => parseFloat(c.promedio)),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, max: 5 }
                    }
                }
            });

            // Tabla de carreras
            let tablaHTML = `
                <div class="chart-container">
                    <div class="chart-title">📊 Resumen por Carrera</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Carrera</th>
                                <th>Total</th>
                                <th>Abandonan</th>
                                <th>Tasa (%)</th>
                                <th>Promedio</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            carrerasArray.forEach(c => {
                const badge = parseFloat(c.tasa) > 50 ? 'badge-malo' : 
                             parseFloat(c.tasa) > 30 ? 'badge-aceptable' : 'badge-bueno';
                tablaHTML += `
                    <tr>
                        <td><strong>${c.nombre}</strong></td>
                        <td>${c.total}</td>
                        <td>${c.abandonan}</td>
                        <td><span class="badge ${badge}">${c.tasa}%</span></td>
                        <td>${c.promedio}</td>
                        <td>${parseFloat(c.tasa) > 50 ? '🔴 Crítico' : 
                              parseFloat(c.tasa) > 30 ? '🟡 Atención' : '🟢 Estable'}</td>
                    </tr>
                `;
            });

            tablaHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            document.getElementById('tablaCarreras').innerHTML = tablaHTML;
        }

        // Generar gráficos detallados
        function generarGraficosDetallados(datos) {
            // Abandono por género
            const generos = {};
            datos.forEach(d => {
                if (!generos[d.genero]) {
                    generos[d.genero] = { total: 0, abandonan: 0 };
                }
                generos[d.genero].total++;
                if (d.abandono === 1) generos[d.genero].abandonan++;
            });

            const generosArray = Object.keys(generos);
            const continuanPct = generosArray.map(g => ((generos[g].total - generos[g].abandonan) / generos[g].total * 100).toFixed(1));
            const abandonanPct = generosArray.map(g => (generos[g].abandonan / generos[g].total * 100).toFixed(1));

            if (charts.genero) charts.genero.destroy();
            charts.genero = new Chart(document.getElementById('chartGenero'), {
                type: 'bar',
                data: {
                    labels: generosArray,
                    datasets: [{
                        label: '✅ Continúan (%)',
                        data: continuanPct,
                        backgroundColor: '#00b894'
                    }, {
                        label: '❌ Abandonan (%)',
                        data: abandonanPct,
                        backgroundColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });

            // Evolución del rendimiento
            const mejoraron = datos.filter(d => d.promedio_cons2 > d.promedio_cons1 + 0.2).length;
            const estables = datos.filter(d => Math.abs(d.promedio_cons2 - d.promedio_cons1) <= 0.2).length;
            const empeoraron = datos.filter(d => d.promedio_cons2 < d.promedio_cons1 - 0.2).length;

            if (charts.evolucion) charts.evolucion.destroy();
            charts.evolucion = new Chart(document.getElementById('chartEvolucion'), {
                type: 'doughnut',
                data: {
                    labels: ['📈 Mejoraron', '➡️ Estables', '📉 Empeoraron'],
                    datasets: [{
                        data: [mejoraron, estables, empeoraron],
                        backgroundColor: ['#00b894', '#f39c12', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

            // Scatter plot
            const scatterData = datos.map(d => ({
                x: d.promedio_cons1,
                y: d.promedio_cons2,
                abandono: d.abandono
            }));

            if (charts.scatter) charts.scatter.destroy();
            charts.scatter = new Chart(document.getElementById('chartScatter'), {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: '✅ Continúan',
                        data: scatterData.filter(d => d.abandono === 0),
                        backgroundColor: 'rgba(0, 184, 148, 0.6)',
                        borderColor: '#00b894',
                        pointRadius: 6
                    }, {
                        label: '❌ Abandonan',
                        data: scatterData.filter(d => d.abandono === 1),
                        backgroundColor: 'rgba(231, 76, 60, 0.6)',
                        borderColor: '#e74c3c',
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: { display: true, text: 'Consolidado 1' },
                            min: 1, max: 5
                        },
                        y: {
                            title: { display: true, text: 'Consolidado 2' },
                            min: 1, max: 5
                        }
                    },
                    plugins: {
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 3, yMax: 3,
                                    borderColor: '#f39c12',
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                },
                                line2: {
                                    type: 'line',
                                    xMin: 3, xMax: 3,
                                    borderColor: '#f39c12',
                                    borderWidth: 2,
                                    borderDash: [5, 5]
                                }
                            }
                        }
                    }
                }
            });

            // Box plot simulado con bar chart
            const abandonanData = datos.filter(d => d.abandono === 1);
            const continuanData = datos.filter(d => d.abandono === 0);

            const stats = [
                calcularEstadisticas(continuanData.map(d => d.promedio_cons1)),
                calcularEstadisticas(abandonanData.map(d => d.promedio_cons1)),
                calcularEstadisticas(continuanData.map(d => d.promedio_cons2)),
                calcularEstadisticas(abandonanData.map(d => d.promedio_cons2))
            ];

            if (charts.box) charts.box.destroy();
            charts.box = new Chart(document.getElementById('chartBox'), {
                type: 'bar',
                data: {
                    labels: ['Cons1 Continúan', 'Cons1 Abandonan', 'Cons2 Continúan', 'Cons2 Abandonan'],
                    datasets: [{
                        label: 'Media',
                        data: stats.map(s => s.mean),
                        backgroundColor: ['#00b894', '#e74c3c', '#00b894', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true, max: 5 }
                    }
                }
            });
        }

        function calcularEstadisticas(arr) {
            arr.sort((a, b) => a - b);
            return {
                min: arr[0],
                max: arr[arr.length - 1],
                mean: arr.reduce((a, b) => a + b, 0) / arr.length,
                median: arr[Math.floor(arr.length / 2)]
            };
        }

        // Generar tabla de datos
        function generarTablaDatos(datos) {
            let tablaHTML = `
                <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                    <strong>📊 Total de registros:</strong> ${datos.length} estudiantes
                </div>
                <table>
                    <thead>
                        <tr>
                            <th style="min-width: 50px;">#</th>
                            <th style="min-width: 120px;">Nombre Completo</th>
                            <th style="min-width: 60px;">Edad</th>
                            <th style="min-width: 80px;">Género</th>
                            <th style="min-width: 120px;">Carrera</th>
                            <th style="min-width: 80px;">Cons 1</th>
                            <th style="min-width: 80px;">Cons 2</th>
                            <th style="min-width: 90px;">Promedio</th>
                            <th style="min-width: 100px;">Categoría</th>
                            <th style="min-width: 100px;">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            datos.forEach((d, i) => {
                const badgeCategoria = d.categoria === 'Malo' ? 'badge-malo' : 
                                      d.categoria === 'Aceptable' ? 'badge-aceptable' : 'badge-bueno';
                
                const nombreCompleto = `${d.nombre} ${d.apellido}`;
                
                tablaHTML += `
                    <tr>
                        <td style="text-align: center;">${i + 1}</td>
                        <td><strong>${nombreCompleto}</strong></td>
                        <td style="text-align: center;">${d.edad}</td>
                        <td>${d.genero}</td>
                        <td>${d.carrera}</td>
                        <td style="text-align: center;">${d.promedio_cons1.toFixed(2)}</td>
                        <td style="text-align: center;">${d.promedio_cons2.toFixed(2)}</td>
                        <td style="text-align: center;"><strong>${d.promedio_general.toFixed(2)}</strong></td>
                        <td style="text-align: center;"><span class="badge ${badgeCategoria}">${d.categoria}</span></td>
                        <td style="text-align: center;">${d.abandono === 1 ? '❌ Abandona' : '✅ Continúa'}</td>
                    </tr>
                `;
            });

            tablaHTML += `
                    </tbody>
                </table>
            `;

            document.getElementById('tablaDatos').innerHTML = tablaHTML;
        }

        // Cambiar tabs
        function cambiarTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.content');

            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                    contents[i].classList.add('active');
                } else {
                    tab.classList.remove('active');
                    contents[i].classList.remove('active');
                }
            });
        }

        // Descargar CSV
        function descargarCSV() {
            if (!datosGlobales) return;

            let csv = 'Nombre,Apellido,Edad,Género,Carrera,Cons1,Cons2,Promedio,Categoría,Abandono\n';
            datosGlobales.forEach(d => {
                csv += `${d.nombre},${d.apellido},${d.edad},${d.genero},${d.carrera},${d.promedio_cons1.toFixed(2)},${d.promedio_cons2.toFixed(2)},${d.promedio_general.toFixed(2)},${d.categoria},${d.abandono === 1 ? 'Sí' : 'No'}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'resultados_analisis.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
